<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <title>Construction Site Report</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:ital,wght@0,400;0,700;1,400;1,700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="header-container">
        <div class="title-container">
            <h1>ูุดุฑูุน ุจุฑุฌ ูุคุงุณ</h1>
            <h2>ุงูุชูุฑูุฑ ุงููููู</h2>
        </div>
        <div class="logo-container">
            <img src="data:image/png;base64,{{ logo_b64 }}" alt="Burj Nawas Logo" class="logo">
        </div>
        <div class="header-left">
            <p><strong>Date:</strong> {{ date }}</p>
            <p><strong>Report No:</strong> {{ report_id }}</p>
        </div>
    </div>

    <!-- Section 1: Weather -->
    <div class="section">
        <h3>1. ุญุงูุฉ ุงูุทูุณ (Weather Conditions)</h3>

        <div class="subsection">

            {% if weather.current %}
            <div class="weather-current-grid">
                <div class="weather-item">
                    <img src="https://cdn-icons-png.flaticon.com/512/7794/7794499.png" alt="Temp Icon"
                        class="weather-icon-small">
                    <div>
                        <span class="label">ุฏุฑุฌุฉ ุงูุญุฑุงุฑุฉ</span>
                        <span class="value">{{ weather.current.main.temp }}ยฐC</span>
                    </div>
                </div>
                <div class="weather-item">
                    <img src="https://cdn-icons-png.flaticon.com/512/2011/2011448.png" alt="Wind Icon"
                        class="weather-icon-small">
                    <div>
                        <span class="label">ุณุฑุนุฉ ุงูุฑูุงุญ</span>
                        <span class="value">{{ weather.current.wind.speed }} m/s</span>
                    </div>
                </div>
                <div class="weather-item">
                    <!-- Use the icon from API if available, else generic -->
                    <img src="{{ weather.current.weather[0].icon_url }}" alt="Condition Icon"
                        class="weather-icon-small">
                    <div>
                        <span class="label">ุงูุญุงูุฉ</span>
                        <span class="value">{{ weather.current.weather[0].description }}</span>
                    </div>
                </div>
            </div>
            {% else %}
            <p>ุจูุงูุงุช ุบูุฑ ูุชุงุญุฉ</p>
            {% endif %}
        </div>

        <!-- Section 2: OpenProject -->
        <div class="section">
            <h3>2. ุจูุงูุงุช ุงููุดุฑูุน (Project Data)</h3>

            <div class="subsection">
                <h4>ุงูุฃุนูุงู ุงููุดุทุฉ ุญุงููุงู (Active Work Packages)</h4>
                <ul>
                    {% for task in projects.active %}
                    <li>
                        <strong>{{ task.subject }}</strong> - {{ task.status }}
                        <span class="due-date">๐ Due: {{ task.dueDate }}</span>
                    </li>
                    {% else %}
                    <li>ูุง ููุฌุฏ ุฃุนูุงู ูุดุทุฉ ุญุงููุงู.</li>
                    {% endfor %}
                </ul>
            </div>

            <!-- Incoming Section Removed -->
        </div>

        <!-- Section 3: Chat Summary -->
        <div class="section">
            <h3>3. ููุฎุต ุฃูุดุทุฉ ุงููููุน (Site Activities Summary)</h3>

            <div class="subsection">
                <h4>ุงูููู ุงูุนุงููุฉ ูุงููุนุฏุงุช (Site Manpower and Machinery)</h4>
                <div class="content">
                    {{ site_manpower_machinery | safe }}
                </div>
            </div>

            <div class="subsection">
                <h4>ุฃูุดุทุฉ ุงููููุน (Site Activities)</h4>
                <div class="content">
                    {{ site_activities | safe }}
                </div>
            </div>
        </div>

        <!-- Section 4: Photos & Analysis -->
        <div class="section">
            <h3>4. ุงูุชูุซูู ุงูุตูุฑู (Photo Documentation)</h3>

            <div class="photo-grid">
                {% for photo in photos %}
                <div class="photo-item">
                    <!-- Use base64 image -->
                    <img src="data:image/jpeg;base64,{{ photo.b64 }}" class="site-photo">
                    <div class="photo-number">ุตูุฑุฉ {{ loop.index }}</div>
                </div>
                {% else %}
                <p>ูุง ููุฌุฏ ุตูุฑ ููุซูุฉ ุงูููู.</p>
                {% endfor %}
            </div>



        <div class="footer">
            <p>ุชู ุงูุดุงุก ุงูุชูุฑูุฑ ุจูุงุณุทุฉ AI Site Coordinator ยฉ {{ date }} ุจุฑุฌ ูุคุงุณ. ุฌููุน ุงูุญููู ูุญููุธุฉ.</p>
        </div>
</body>

</html>